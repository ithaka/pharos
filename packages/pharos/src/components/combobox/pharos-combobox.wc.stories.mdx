import { Story, Canvas, Meta, ArgsTable } from '@storybook/addon-docs/blocks';
import { html } from 'lit-html';
import { action } from '@storybook/addon-actions';
import { ifDefined } from 'lit-html/directives/if-defined';

import './pharos-combobox';
import '../link/pharos-link';
import createFormData from '../../utils/createFormData';

<Meta
  title="Forms/Combobox"
  parameters={{
    options: { selectedPanel: 'addon-controls' },
    controls: { expanded: true },
  }}
/>

# Combobox

<pharos-link href="https://www.jstor.org/pharos/components/combobox" target="_blank">See guidelines in Pharos</pharos-link>

export const Template = (args) =>
  html`
    <pharos-combobox
      .value=${ifDefined(args.value)}
      .name=${ifDefined(args.name)}
      ?open=${args.open}
      ?disabled=${args.disabled}
      ?hide-label=${args.hideLabel}
      ?invalidated=${args.invalidated}
      ?validated=${args.validated}
      .placeholder=${ifDefined(args.placeholder)}
      message=${ifDefined(args.message)}
      ?required=${args.required}
    >
      <span slot="label">${args.label}</span>
      <option value="1">Bulbasaur</option>
      <option value="2">Charmander</option>
      <option value="3">Squirtle</option>
      <option value="4">Caterpie</option>
      <option value="5">Weedle</option>
      <option value="6">Pidgey</option>
      <option value="7">Rattata</option>
      <option value="8">Spearow</option>
      <option value="9">Ekans</option>
      <option value="10">Pikachu</option>
      <option value="11">Sandshrew</option>
      <option value="12">Clefairy</option>
      <option value="13">Magikarp</option>
      <option value="14">Snorlax</option>
    </pharos-combobox>
  `;

<Canvas withToolbar>
  <Story
    name="Base"
    args={{
      open: false,
      disabled: false,
      hideLabel: false,
      label: 'I choose you',
    }}
  >
    {Template.bind({})}
  </Story>
</Canvas>

## API

<ArgsTable of="pharos-combobox" />

# States

<Canvas withToolbar>
  <Story name="States">
    {html`
      <div
        style="display: grid; display: -ms-grid; grid-gap: 7rem; grid-template-columns: repeat(2, 300px); -ms-grid-columns: 300px 7rem 300px"
      >
        <pharos-combobox>
          <span slot="label">I am empty</span>
          <option value="1">Option 1</option>
          <option value="2">Option 2</option>
          <option value="3">Option 3</option>
        </pharos-combobox>
        <pharos-combobox disabled style="-ms-grid-column: 3">
          <span slot="label">I am disabled</span>
          <option value="1">Option 1</option>
          <option value="2">Option 2</option>
          <option value="3">Option 3</option>
        </pharos-combobox>
        <pharos-combobox placeholder="Enter some text" style="-ms-grid-column: 3; -ms-grid-row: 2">
          <span slot="label">I have a placeholder</span>
          <option value="1">Option 1</option>
          <option value="2">Option 2</option>
          <option value="3">Option 3</option>
        </pharos-combobox>
        <pharos-combobox value="2" style="-ms-grid-row: 3">
          <span slot="label">I have a value provided</span>
          <option value="1">Option 1</option>
          <option value="2">Option 2</option>
          <option value="3">Option 3</option>
        </pharos-combobox>
        <pharos-combobox hide-label style="-ms-grid-column: 3; -ms-grid-row: 3">
          <span slot="label">My label is hidden</span>
          <option value="1">Option 1</option>
          <option value="2">Option 2</option>
          <option value="3">Option 3</option>
        </pharos-combobox>
      </div>
    `}
  </Story>
</Canvas>

# Events

<Canvas withToolbar>
  <Story name="Events">
    {() => {
      return html`
        <div
          style="display: grid; display: -ms-grid; grid-gap: 1rem; grid-template-columns: 300px; -ms-grid-columns: 300px"
        >
          <pharos-combobox
            placeholder="Who's that Pokemon?"
            @change="${(e) => action('Change')(e.target.value)}"
            @input="${(e) => action('Input')(e.target['_input'].value)}"
          >
            <span slot="label">I fire events on input</span>
            <option value="bu">Bulbasaur</option>
            <option value="ch">Charmander</option>
            <option value="sq">Squirtle</option>
            <option value="ca">Caterpie</option>
            <option value="we">Weedle</option>
            <option value="pi">Pidgey</option>
            <option value="ra">Rattata</option>
            <option value="sp">Spearow</option>
            <option value="ek">Ekans</option>
            <option value="pi">Pikachu</option>
            <option value="sa">Sandshrew</option>
            <option value="cl">Clefairy</option>
            <option value="ma">Magikarp</option>
            <option value="sn">Snorlax</option>
            <option value="me">Mew</option>
            <option value="mw">Mewtwo</option>
          </pharos-combobox>
        </div>
      `;
    }}
  </Story>
</Canvas>

# Search Mode

<Canvas withToolbar>
  <Story name="Search Mode">
    {() => {
      return html`
        <pharos-combobox placeholder="Search for things" search-mode>
          <span slot="label">I'm searching for</span>
          <option value="1">Option 1</option>
          <option value="2">Option 2</option>
          <option value="3">Option 3</option>
        </pharos-combobox>
      `;
    }}
  </Story>
</Canvas>

# Validity

<Canvas withToolbar>
  <Story
    name="Validity"
    args={{
      required: true,
      invalidated: true,
      validated: false,
      message: 'This field is required, please make a selection',
    }}
  >
    {((args) => {
      return html`
        <div
          style="display: grid; display: -ms-grid; grid-gap: 1rem; grid-template-columns: 300px; -ms-grid-columns: 300px"
        >
          <pharos-combobox
            name="my-combobox"
            placeholder="Enter some text"
            @change="${(e) => action('Change')(e.target.value)}"
            @input="${(e) => action('Input')(e.target['_input'].value)}"
            ?required="${args.required}"
            ?invalidated="${args.invalidated}"
            ?validated="${args.validated}"
            message="${args.message}"
          >
            <span slot="label">Test me out</span>
            <option value="1">Option 1</option>
            <option value="2">Option 2</option>
            <option value="3">Option 3</option>
          </pharos-combobox>
        </div>
      `;
    }).bind({})}
  </Story>
</Canvas>

# Form Data

<Canvas withToolbar>
  <Story name="Form Data">
    {() => {
      return html`
        <div
          style="display: grid; display: -ms-grid; grid-gap: 1rem; grid-template-columns: 300px; -ms-grid-columns: 300px"
        >
          <form name="my-form" action="https://httpbin.org/post" method="POST">
            <pharos-combobox
              name="my-combobox"
              placeholder="Enter some text"
              @change="${(e) => action('Change')(e.target.value)}"
              @input="${(e) => action('Input')(e.target['_input'].value)}"
              required
            >
              <span slot="label">Test me out</span>
              <option value="1">Option 1</option>
              <option value="2">Option 2</option>
              <option value="3">Option 3</option>
            </pharos-combobox>
            <input
              type="submit"
              value="Submit"
              @click="${(e) => {
                e.preventDefault();
                const form = document.querySelector('form[name="my-form"]');
                const formData = createFormData(form);
                const xhr = new XMLHttpRequest();
                xhr.open('POST', 'https://httpbin.org/post', true);
                xhr.onload = function () {
                  const response = JSON.parse(this.responseText);
                  action('FormData')(JSON.stringify(response.form));
                };
                xhr.send(formData);
              }}"
            />
          </form>
        </div>
      `;
    }}
  </Story>
</Canvas>
