import { Story, Canvas, Meta, ArgsTable } from '@storybook/addon-docs/blocks';
import { html } from 'lit-html';
import { action } from '@storybook/addon-actions';
import { ifDefined } from 'lit/directives/if-defined';

import './pharos-textarea';
import createFormData from '../../utils/createFormData';
import Intro from '@docs/guidelines/textarea.docs.mdx';

<Intro />

<Meta
  title="Forms/Textarea"
  parameters={{
    options: { selectedPanel: 'addon-controls' },
  }}
/>

# Examples

export const Template = (args) =>
  html`
    <div
      style="display: grid; display: -ms-grid; grid-gap: 1rem; grid-template-columns: 250px; -ms-grid-columns: 250px"
    >
      <pharos-textarea
        name="story-input"
        .cols="${args.columns}"
        ?disabled=${args.disabled}
        ?hide-label="${args.hideLabel}"
        ?invalidated=${args.invalidated}
        .message=${args.message}
        .placeholder=${args.placeholder}
        .resize="${ifDefined(args.resize)}"
        ?readonly=${args.readonly}
        .rows="${args.rows}"
        ?required=${args.required}
        ?validated=${args.validated}
        .value=${args.value}
      >
        <span slot="label">${args.label}</span>
      </pharos-textarea>
    </div>
  `;

<Canvas withToolbar>
  <Story
    name="Base"
    args={{
      label: 'I am a label',
      hideLabel: false,
      columns: 20,
      rows: 2,
      value: 'Some text',
    }}
  >
    {Template.bind({})}
  </Story>
</Canvas>

## API

<ArgsTable of="pharos-textarea" />

# States

<Canvas withToolbar>
  <Story name="States">
    {html`
      <div
        style="display: grid; display: -ms-grid; grid-gap: 1rem; grid-template-columns: repeat(2, 250px); -ms-grid-columns: 250px 1rem 250px"
      >
        <pharos-textarea><span slot="label">I am empty</span></pharos-textarea>
        <pharos-textarea disabled style="-ms-grid-column: 3"
          ><span slot="label">I am disabled</span></pharos-textarea
        >
        <pharos-textarea readonly value="Can't touch this" style="-ms-grid-row: 2"
          ><span slot="label">I am read-only</span></pharos-textarea
        >
        <pharos-textarea placeholder="Enter some text" style="-ms-grid-column: 3; -ms-grid-row: 2"
          ><span slot="label">I have a placeholder</span></pharos-textarea
        >
        <pharos-textarea value="Hi there" style="-ms-grid-row: 3"
          ><span slot="label">I have a value provided</span></pharos-textarea
        >
        <pharos-textarea resize="none" style="-ms-grid-column: 3; -ms-grid-row: 3"
          ><span slot="label">I can't be resized</span></pharos-textarea
        >
      </div>
    `}
  </Story>
</Canvas>

# Events

<Canvas withToolbar>
  <Story name="Events">
    {() => {
      return html`
        <div
          style="display: grid; display: -ms-grid; grid-gap: 1rem; grid-template-columns: 250px; -ms-grid-columns: 250px"
        >
          <pharos-textarea
            placeholder="Enter some text"
            @change="${(e) => action('Change')(e.target.value)}"
            @input="${(e) => action('Input')(e.target.value)}"
          >
            <span slot="label">I fire events on input</span>
          </pharos-textarea>
        </div>
      `;
    }}
  </Story>
</Canvas>

# Validity

<Canvas withToolbar>
  <Story
    name="Validity"
    argTypes={{
      label: { table: { disable: true }, defaultValue: 'Test me out' },
      placeholder: {
        table: { disable: true },
        defaultValue: 'Enter some text',
      },
      value: { table: { disable: true }, defaultValue: ' ' },
    }}
    args={{
      required: true,
      invalidated: true,
      validated: false,
      message: 'This field does not meet the requirements',
    }}
  >
    {Template.bind({})}
  </Story>
</Canvas>

# Custom Error Message

export const CustomTemplate = (args) =>
  html`
    <div
      style="display: grid; display: -ms-grid; grid-gap: 1rem; grid-template-columns: 350px; -ms-grid-columns: 350px"
    >
      <pharos-textarea
        placeholder="Enter some text"
        @change="${(e) => action('Change')(e.target.value)}"
        @input="${(e) => action('Input')(e.target.value)}"
        ?required=${args.required}
        ?invalidated=${args.invalidated}
        ?validated=${args.validated}
        .message=${args.message}
      >
        <span slot="label">I am invalid</span>
        <span slot="message">
          <p>Must be over 100 characters long</p>
        </span>
      </pharos-textarea>
    </div>
  `;

<Canvas withToolbar>
  <Story
    name="Custom Error Message"
    args={{
      required: false,
      invalidated: true,
      validated: false,
      message: 'This field does not meet the requirements',
    }}
  >
    {CustomTemplate.bind({})}
  </Story>
</Canvas>

# Form Data

<Canvas withToolbar>
  <Story name="Form Data">
    {() => {
      return html`
        <div
          style="display: grid; display: -ms-grid; grid-gap: 1rem; grid-template-columns: 350px; -ms-grid-columns: 350px"
        >
          <form name="my-form" action="https://httpbin.org/post" method="POST">
            <pharos-textarea
              name="my-textarea"
              placeholder="Enter some text"
              @change="${(e) => action('Change')(e.target.value)}"
              @input="${(e) => action('Input')(e.target.value)}"
              required
            >
              <span slot="label">I am invalid</span>
            </pharos-textarea>
            <input
              type="submit"
              value="Submit"
              @click="${(e) => {
                e.preventDefault();
                const form = document.querySelector('form[name="my-form"]');
                const formData = createFormData(form);
                const xhr = new XMLHttpRequest();
                xhr.open('POST', 'https://httpbin.org/post', true);
                xhr.onload = function () {
                  const response = JSON.parse(this.responseText);
                  action('FormData')(JSON.stringify(response.form));
                };
                xhr.send(formData);
              }}"
            />
          </form>
        </div>
      `;
    }}
  </Story>
</Canvas>
